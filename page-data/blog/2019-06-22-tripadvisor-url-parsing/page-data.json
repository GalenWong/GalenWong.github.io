{"componentChunkName":"component---src-templates-blog-template-blog-template-tsx","path":"/blog/2019-06-22-tripadvisor-url-parsing/","webpackCompilationHash":"3bee29514ac53bf05d51","result":{"data":{"markdownRemark":{"html":"<h3 id=\"code-classlanguage-textblogs0--new-blogcode\"><a href=\"#code-classlanguage-textblogs0--new-blogcode\" aria-label=\"code classlanguage textblogs0  new blogcode permalink\" class=\"gatsby-remark-autolink-headers-a-tags\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">blogs[0] = new Blog();</code></h3>\n<p>This is my first technical blog\n(indexed as the “zeroth” to fit into the CS persona).\nI feel like I am finally technical enough with ample\namount of CS theories (thanks UCLA for that) to write\nsomething up that makes more sense\n(and potentially interesting).</p>\n<p>I sprinkle links on some technical terms in case\nyou want to understand what they mean.</p>\n<h3 id=\"the-trippy-tripadvisor\"><a href=\"#the-trippy-tripadvisor\" aria-label=\"the trippy tripadvisor permalink\" class=\"gatsby-remark-autolink-headers-a-tags\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Trippy TripAdvisor</h3>\n<p>Anyway, back to the main topic.\nOn the first day of internship, the company wants to run some tests\non some hotel websites for collecting some data. The first step is\nto get as many URLs of hotel websites as possible.\nAn approach is to write a webparser for TripAdvisor.</p>\n<h4 id=\"insert-inspirational-anchor-quote\"><a href=\"#insert-inspirational-anchor-quote\" aria-label=\"insert inspirational anchor quote permalink\" class=\"gatsby-remark-autolink-headers-a-tags\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>&#x3C;Insert Inspirational “Anchor” Quote></h4>\n<p>There is a link to the hotel’s webpage right on the\nTripAdvisor page for each hotel.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7801cd907c57e8c4615ccf4a426aa88d/a6404/hotel.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.728643216080403%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABLElEQVQY01WPS0vDUBCFoytxoUKXuvUviptCu/KxLQr6A1Sw3YnWtkIFFy4UNH0/6AtN06QQm5C2aR6fN21VHDh3zpwzd+4daedsn/XTPXZvEkSSR2yeRNlOxFg7jyJdxVm5jLO6xA+XLmJsJg/ZEoikxJ3UMRvXB3MuPbSrZJolMq0yuW6NXKvCY7dOWmjZblWgRrpd4a4j+gS/7yy020aBrOC5Xp28/ES+XSYtZkg4Lsw8LMvCmzp44ykE/EXIHQfMEYy+FtwP/ve47qIWkJ5lmZdikUKpTK3R5PVdRhsO5/7M8/A9l8C2YGKLQR5B4ENY+yKHXqgt3/XFKb31ezT6HyiKgqZp6LqOqqq/2TAMJuIHlm1jii3CTYYDBVVX0Qaf2CMDwzQZCz+Mb+XMV7hcPYkOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hotel.png\"\n        title=\"hotel.png\"\n        src=\"/static/7801cd907c57e8c4615ccf4a426aa88d/e49a9/hotel.png\"\n        srcset=\"/static/7801cd907c57e8c4615ccf4a426aa88d/8d449/hotel.png 160w,\n/static/7801cd907c57e8c4615ccf4a426aa88d/01387/hotel.png 320w,\n/static/7801cd907c57e8c4615ccf4a426aa88d/e49a9/hotel.png 640w,\n/static/7801cd907c57e8c4615ccf4a426aa88d/f570d/hotel.png 960w,\n/static/7801cd907c57e8c4615ccf4a426aa88d/0309e/hotel.png 1280w,\n/static/7801cd907c57e8c4615ccf4a426aa88d/a6404/hotel.png 1990w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Cool, our job is done. Just search for that\n<a href=\"https://www.w3schools.com/tags/tag_a.asp\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">anchor tag</a>\n(<code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>xxx<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code>) and we are good to go.\nEasy. At this point, I was thinking about what to eat\nfor dinner already.</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mrow><mi mathvariant=\"script\">W</mi><mi mathvariant=\"script\">h</mi><mi mathvariant=\"script\">e</mi><mi mathvariant=\"script\">n</mi><mtext>  </mtext><mi mathvariant=\"script\">y</mi><mi mathvariant=\"script\">o</mi><mi mathvariant=\"script\">u</mi><mtext>  </mtext><mi mathvariant=\"script\">t</mi><mi mathvariant=\"script\">h</mi><mi mathvariant=\"script\">i</mi><mi mathvariant=\"script\">n</mi><mi mathvariant=\"script\">k</mi><mtext>  </mtext><mi mathvariant=\"script\">i</mi><msup><mi mathvariant=\"script\">t</mi><mo mathvariant=\"script\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mi mathvariant=\"script\">s</mi><mtext>  </mtext><mi mathvariant=\"script\">e</mi><mi mathvariant=\"script\">a</mi><mi mathvariant=\"script\">s</mi><mi mathvariant=\"script\">y</mi><mo separator=\"true\">,</mo></mrow><mtext> </mtext><mrow><mi mathvariant=\"script\">i</mi><mi mathvariant=\"script\">t</mi><mtext>  </mtext><mi mathvariant=\"script\">i</mi><mi mathvariant=\"script\">s</mi><mtext>  </mtext><mi mathvariant=\"script\">r</mi><mi mathvariant=\"script\">e</mi><mi mathvariant=\"script\">a</mi><mi mathvariant=\"script\">l</mi><mi mathvariant=\"script\">l</mi><mi mathvariant=\"script\">y</mi><mtext>  </mtext><mi mathvariant=\"script\">n</mi><mi mathvariant=\"script\">o</mi><mi mathvariant=\"script\">t</mi><mi mathvariant=\"script\">.</mi></mrow><mo>−</mo><mtext>Me, Right now</mtext></mrow><annotation encoding=\"application/x-tex\">\\mathcal {When\\;you\\;think\\;it&#x27;s\\;easy,} \n\\,\n\\mathcal {it\\;is\\;really\\;not.}\n- \\text{Me, Right now}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.996332em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathcal\" style=\"margin-right:0.08222em;\">W</span><span class=\"mord mathdefault\">h</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">u</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">h</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mord\"><span class=\"mord mathdefault\">t</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.801892em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mpunct\">,</span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">t</span><span class=\"mord\">.</span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord text\"><span class=\"mord\">Me, Right now</span></span></span></span></span></span>\n<p>Let’s check the anchor tag out, with everybody’s favorite\n<a href=\"https://developers.google.com/web/tools/chrome-devtools/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">C</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>m</mi><mi>e</mi><mtext>  </mtext><mi>D</mi><mi>e</mi><mi>v</mi><mtext>  </mtext><mi>T</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal Chrome\\;Dev\\;Tools</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.05834em;\">C</span><span class=\"mord mathdefault\">h</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">e</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathdefault\">s</span></span></span></span></a>.\nThen, we can use the same\n<a href=\"https://www.w3schools.com/xml/xml_xpath.asp\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">XPath</a>\nto get the data and just extract <code class=\"language-text\">a.href</code> property.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ec84204437c367f5ff161ebf94e854a/43985/notanchor.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.49238578680203%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAACFUlEQVQoz12SzWsTURRH519xI124dCeKCxfuFKGCICIW0Y3iQlxIqYgt3ahIRTduFLVglSJKWm2StrZNmqSNMc1Mkn4kmbZp0qZpZibTyWQySY6vjSJ44cDb/M7l3XuldrvNAf9Xq93CcRzq9TqNRgPdMFhfTpHPraHIGcJBmWAwTSCwTCS4RDiU5GdsDemvwKzYlEsWpaLJjsCs1rD2TVwhOyhdq5BNKuRXkoTmU3jGFby+Dn6/jNer8O27guS6TSxDIxTLMh4pMr5YIrxSxXSaGPs2Zq1BTbz1cpmNuSnyqykiCyt4J2QhSuDzyQIF30Sc6SkZaXVVEWGHbU1H3TWILoaJhmbIxKbZSkxiqPM42hp7QphbDKHmsizFEgSmFwjOxoj8mCMamBeZKPJSEun9816GXw6QC39mM+ph4cMg0eE+5NF+VN8QG/6nZPwvxJd1SoUCu8UCueUsqXiaTCZPNrMpmuRR1W3U9W0kNfKON/1XGLh2mi+v+vC/HSA2OcJWLsmM5yNDt88R//QAp+F2hq2Xaeo61s4ejlXDdtpicS1s2xVLdJFGn9yg/+pJuo8f4fHgQ+72XCDg+3qY/RWcpPf8Mfyv7/8TVjWcSoW9rSK7hRKVso2m1Q+xrDrS8KPr9Jw6yqUTXfTdvMit7jPMjo1QF9l0PMyds108u3dZnM4foW3hGCbVHY2m69Jqdc6uA/wG+Awo+MYiphcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"notanchor\"\n        title=\"notanchor\"\n        src=\"/static/3ec84204437c367f5ff161ebf94e854a/e49a9/notanchor.png\"\n        srcset=\"/static/3ec84204437c367f5ff161ebf94e854a/8d449/notanchor.png 160w,\n/static/3ec84204437c367f5ff161ebf94e854a/01387/notanchor.png 320w,\n/static/3ec84204437c367f5ff161ebf94e854a/e49a9/notanchor.png 640w,\n/static/3ec84204437c367f5ff161ebf94e854a/f570d/notanchor.png 960w,\n/static/3ec84204437c367f5ff161ebf94e854a/0309e/notanchor.png 1280w,\n/static/3ec84204437c367f5ff161ebf94e854a/43985/notanchor.png 1970w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">N</mi><mi mathvariant=\"script\">A</mi><mi mathvariant=\"script\">N</mi><mi mathvariant=\"script\">I</mi><mo stretchy=\"false\">?</mo><mo stretchy=\"false\">!</mo></mrow><annotation encoding=\"application/x-tex\">\\mathcal{NANI?!}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\" style=\"margin-right:0.14736em;\">N</span><span class=\"mord mathcal\">A</span><span class=\"mord mathcal\" style=\"margin-right:0.14736em;\">N</span><span class=\"mord mathcal\" style=\"margin-right:0.07382em;\">I</span><span class=\"mclose\">?</span><span class=\"mclose\">!</span></span></span></span></span> There is no anchor tag.\nHow does that work? When you click on the element,\nit opens a new tab. Then, it takes you to a URL that\nbelongs to TripAdvisor. For instance,</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">https://www.tripadvisor.com/Commerce?p=TABAIndependentHotels&amp;src=0&amp;from=Hotel_Review&amp;...\n(omitted for readability)</code></pre></div>\n<p>After that, you get redirected to the actual website.\nCuriously, the way that the redirection is done is\n<strong>not</strong> through the\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#Redirection_messages\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">HTTP 300 status codes</a>.\nThey did it through JavaScript! The above URL\nreturns the following html page\n(information are hidden for readability). </p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            window<span class=\"token punctuation\">.</span>history<span class=\"token punctuation\">.</span><span class=\"token function\">replaceState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>fromBABackClick<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            window<span class=\"token punctuation\">.</span>history<span class=\"token punctuation\">.</span><span class=\"token function\">replaceState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>fromBackClick<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token string\">\"http://www.royalview.com.hk/eng/index.html?utm_source=TripAdvisor&amp;utm_medium=BusinessListing&amp;utm_campaign=TripAdvisor&amp;utm_term=Website&amp;utm_content=Website\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://www.royalview.com.hk/eng/index.html?utm_source=TripAdvisor&amp;utm_medium=BusinessListing&amp;utm_campaign=TripAdvisor&amp;utm_term=Website&amp;utm_content=Website\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Then, the redirection is done through changing\n<code class=\"language-text\">window.location.href</code>.\nA thing that confuses me is the condition of the\nif statements. What is up with <code class=\"language-text\">if (&quot;&quot;)</code> and <code class=\"language-text\">if (true)</code>?\n<del>Did TripAdvisor engineer not take intro CS course?</del>\nI feel like this html page is probably generated from a\ntemplate. If certain conditions are true, for instance,\nthe <code class=\"language-text\">User-Agent</code> in the HTTP request header is not\n(too obvisouly) a bot, they fill in the condition as\n<code class=\"language-text\">true</code> or <code class=\"language-text\">&quot;&quot;</code> or some other literals. But this is just\nmy guess.</p>\n<p>Now, I understand how the redirection works.\nThe link is clicked, a new tab opens that points to\na TripAdvisor endpoint, which returns a script that\nredirect you to the actual site.</p>\n<p>Then, the parser will just need to get the script and\nextract the URL. A simple regular expression will work\nhere. To get a clean URL without the utm\nparameters, which are used by Google Analytics, we\ncan use the <code class=\"language-text\">URL</code> object in JavaScript (or the equivalent\nURL parsing utils in other languages) to decode it\nand remove the query parameters. </p>\n<h4 id=\"how-to-get-redirected\"><a href=\"#how-to-get-redirected\" aria-label=\"how to get redirected permalink\" class=\"gatsby-remark-autolink-headers-a-tags\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to Get Redirected?</h4>\n<p>The problem is still not fully solved yet!\nHow did we get the TripAdvisor link to get redirected\nanyway? Aka…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">https://www.tripadvisor.com/Commerce?p=TABAIndependentHotels&amp;src=0&amp;geo=652907&amp;from=Hotel_Review&amp;... \n(How do we get this?)</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1f18352ca3c26e3a24fedd4bc61ca11a/2675f/pika-how.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.09072375127421%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABAElEQVQY041QbU6EMBDlVN7FM/jHM3kIL+EvEmMCK5RdWBJkgW6h0O9n2yzGGE18yctM25k3b5o45xCwrSNmRmL+0b1gXWnMnbMINf9lsgtaq9GcnnA+PiJ7fYDREn9h79nj9/skJl4sYGqeQd7uMFb3kOIMbYDrlWIYBlBKsSwLjDE3AzbGeZ7BGPMbrfF8c+hg/LsSF+gphaMVLGewWuPwfkBZliCEoGmaKDiOI/I8R9/3kVmWoW1bCCGQcM7RdR2qikDxzVvisJTBXHogNE8T0jRFURRRKED7QUqpyOCurus4NMQkTJRS+vUM3LbCCU+t4JT8Wi0UBne//dtPfAILsM3v9Ua7uwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pika-how.png\"\n        title=\"pika-how.png\"\n        src=\"/static/1f18352ca3c26e3a24fedd4bc61ca11a/e49a9/pika-how.png\"\n        srcset=\"/static/1f18352ca3c26e3a24fedd4bc61ca11a/8d449/pika-how.png 160w,\n/static/1f18352ca3c26e3a24fedd4bc61ca11a/01387/pika-how.png 320w,\n/static/1f18352ca3c26e3a24fedd4bc61ca11a/e49a9/pika-how.png 640w,\n/static/1f18352ca3c26e3a24fedd4bc61ca11a/f570d/pika-how.png 960w,\n/static/1f18352ca3c26e3a24fedd4bc61ca11a/0309e/pika-how.png 1280w,\n/static/1f18352ca3c26e3a24fedd4bc61ca11a/2675f/pika-how.png 1962w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Again, there is no anchor tag. The only possibility\nis that some JavaScript code opens the new tab.\nThe closest thing that I can find is a suspicious\n<code class=\"language-text\">data-ahref</code> attribute within the <code class=\"language-text\">div</code> tag,\nand the <code class=\"language-text\">onclick</code> event of the tag.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> \n<span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>is-hidden-mobile blEntry website  ui_link_container level_1<span class=\"token punctuation\">\"</span></span> \n<span class=\"token attr-name\">data-ahref</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>LzW421rb7blCMV2VCMVCIz10...(omitted)<span class=\"token punctuation\">\"</span></span> \n<span class=\"token attr-name\">data-column</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>2<span class=\"token punctuation\">\"</span></span> \n<span class=\"token attr-name\">data-trackingkey</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> \n<span class=\"token attr-name\">data-eventname</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>bl_contact_website<span class=\"token punctuation\">\"</span></span> \n<span class=\"token attr-name\">data-blcontact</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>URL_HOTEL<span class=\"token punctuation\">\"</span></span> \n<span class=\"token attr-name\">data-commerce</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> \n<span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>widgetEvCall('handlers.onWebLinkClicked', event, this)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>If it is JavaScript, then it will be “easy” to find\nhow it works.\nAgain using the debugger in our fav\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">C</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>m</mi><mi>e</mi><mtext>  </mtext><mi>D</mi><mi>e</mi><mi>v</mi><mtext>  </mtext><mi>T</mi><mi>o</mi><mi>o</mi><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal Chrome\\;Dev\\;Tool</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.05834em;\">C</span><span class=\"mord mathdefault\">h</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">e</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right:0.01968em;\">l</span></span></span></span>, we set a breakpoint on the <code class=\"language-text\">onclick</code>\nevent.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2ea6fd234acf08b54769ccab8b2d2af/d4d70/break-onclick.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 158.09128630705396%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAABYlAAAWJQFJUiTwAAAEBklEQVRIx6VWi26rRhDl/3+o0pUq9Uqt8riJnTSJH9hgAwZsYx5+xA9sOJ0zDg72bdOkRRotsMvZszNnZjCiaIqR5yGKIsxmMQaDAcbjMeLZDPZwiKk7hN9po92zMXYcpGYLiyzFcrVE3Jd3nok0CRAnqWIYjjtCzxpgMpnANE3Yto3pdKqTaZYhkXtfwDqPLdjPHSSei7m8zypLExnT07NhOwEaT12E4wnm80xsjuVy+W6rFaJxiJUwWvS62Mj9HkCe75EfDsiLEvle7vNczUiSGJ1OB12zj74lTLomen0L9mCIOI51A09cstnlQHEAZmNgnx9tvQKyWO65xfEy0jRDz+zg5uo7ftzd4/r6Gje3tzLeoPnwoM/Pz8+6eyGMyol/tPEIZTxF2W+hXM5RClhZljCyuTg3cuD0fkerYwlTE88vbbGWMiZTWwK13W71A/0QP1+ce2OYyhH7MHuWWF+t3TFP48gP4LreO+A/WcWQgJZFsB5eWh21VrsrYF0FCsJQ5VQUhdqHoBUgtUcAArVkJLvJZKpRfn19xXq9PjvWR5dEOVHt0XdP4jfXG52AaCuRDQEZbT7z6JvN5sw4z5FrDN/3laHrOioPipQfkvl0GiESYVOfYRio2Cl6Cpgf0ypB854ZZnBBlRlkS+1x9CUYptnVKPcGPiwnRCS+5KaLxeJkPEH9JAZTzrIH6reZ5C+PW8+WiWy2L6BWuZAfc1Oe4jJQxo6ClZe73U4XcCF34uRBhEyXlGVxVN/bRx8Ghcftmj3VoTcanXxCdjzSSN7VdfavsgnDMR7+fNIIM49fWm1xga2+ZIDos4pVfbx8d2IYinArITPlWBjUh8Iumy+UdVkUn9dhEITKjkDMEts+1kYGI5Xi67eeUO62nwdkZIeOq4A0CnsgUvHFFatAUs9sH4vBJwKigIwonc/KTZ2dVRCxQMRafOXIr6IplnpGmVUbF9EMg+CLgKLyTILQFWGPpSBsNtszAAbty4CJCJrFlIBJkp4BBP+FIQHtoaOAzJj6sSnwOqCCVsB/s4FxrCyZ5jMbVZbN39mI5bIBe8mlb+tr6uAKSCHbA0eyI/kpE3bSJota1FGTUP35jOF0lqAvDA81JnpJq8y9AYrQA9jZFhnKKDxvUpepF2UbvDgLuI6tqVZUDNl3txvkkehQQJDOUGYJStc6ts9ldtzggoQhb+DFJYZ+jIkU2bVkB5s3F0NSbhdHKKQPI4lQbqWscY49mRvIhpd5bpSHXAD3sLxIq/ZaRF7kO2VayKKt1Mu9rK2edUTt+a0bVmZUZ0/lp4c9OJVj/5/LuGvc467RwK+/fccv377hj6srNB8fcf/QREN+RW7vfug87/lr0lBr6rxa833k3F8JbJEt8oC90gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"break-onclick.png\"\n        title=\"break-onclick.png\"\n        src=\"/static/d2ea6fd234acf08b54769ccab8b2d2af/e49a9/break-onclick.png\"\n        srcset=\"/static/d2ea6fd234acf08b54769ccab8b2d2af/8d449/break-onclick.png 160w,\n/static/d2ea6fd234acf08b54769ccab8b2d2af/01387/break-onclick.png 320w,\n/static/d2ea6fd234acf08b54769ccab8b2d2af/e49a9/break-onclick.png 640w,\n/static/d2ea6fd234acf08b54769ccab8b2d2af/f570d/break-onclick.png 960w,\n/static/d2ea6fd234acf08b54769ccab8b2d2af/d4d70/break-onclick.png 964w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"stepping-through-the-code\"><a href=\"#stepping-through-the-code\" aria-label=\"stepping through the code permalink\" class=\"gatsby-remark-autolink-headers-a-tags\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stepping through the code</h4>\n<p>Turns out it was not as easy as I think it would be.\nThe JavaScript are being embedded into a html file.\nFor some reason, the Chrome debugger is not\nshowing the file 😞. Maybe it is beacause it is\n<a href=\"https://developers.google.com/speed/docs/insights/MinifyResources\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">minified</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/82cba41081f0eca82cb0d505c6d63ed6/1fbbf/blank_debugger.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.63894967177243%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABvElEQVQoz32R2XKjMBBF/f+/N5M4ODixjdlsswixI3HmQqZq3oaqritK6tN9uw9JkvJ8PrnfI74vAeFXwOl84vz1QZJeyPIrxetOdP8milPSJCbLEm433WUxbWtpmpqqzKmqkkNwCgnDM6YpaIcA270rjrsOwxG/BHh/YppOpPE7eRLwelypy0yQjLHPGbqcaXhiTcohSRKOH4GSR5QFXYt+fs6Lg3EGt+IUYfjJ9zXlnjSkmZGavTtjaqxtdqeHOI4Jz1/0rUCtYa1erH3H6h0r7KHyeOd4vEol9oI7/OppO0tRVtS1kd2Koig4RFHE2/GDzhgljqxWUHW5g+uCtXjCPKphx/VeUjcjr9ozvx400YXyHPBIH1SmoSw1w9vtxq/f7wLWsmvBShfZHdSxgNQCjoNAXospMFWrJQ2MAixayGwtU9fhxhHbND+Wg9OnBiub08zcTyzD35gWbdHJ5mZRdZQ0N3LQDzi9932P33RzpJH1utstb8BRj5cFzWQDeGzr6TtPUXnE3ac5tKPmZenV8TTP9MM/XbxmKujhcrnI8hudqv3vc0ootRSjBWzFnarPgi3SRbqd8zznD5Abr3FRSs3eAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"blank_debugger.png\"\n        title=\"blank_debugger.png\"\n        src=\"/static/82cba41081f0eca82cb0d505c6d63ed6/e49a9/blank_debugger.png\"\n        srcset=\"/static/82cba41081f0eca82cb0d505c6d63ed6/8d449/blank_debugger.png 160w,\n/static/82cba41081f0eca82cb0d505c6d63ed6/01387/blank_debugger.png 320w,\n/static/82cba41081f0eca82cb0d505c6d63ed6/e49a9/blank_debugger.png 640w,\n/static/82cba41081f0eca82cb0d505c6d63ed6/f570d/blank_debugger.png 960w,\n/static/82cba41081f0eca82cb0d505c6d63ed6/0309e/blank_debugger.png 1280w,\n/static/82cba41081f0eca82cb0d505c6d63ed6/1fbbf/blank_debugger.png 1828w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>However, the <code class=\"language-text\">Scope</code> tab is quite useful.\nThe <code class=\"language-text\">Scope</code> tab displays the names and the values\nof the variables or constants that can be accessed\nwithin the current execution frame\n(the current function stack, if we think about it\nin the C/C++ way). These variables and constants\nare inside to be <strong>in scope</strong> of the current\nfunction.\nLooking at the change of the local variables, we\nfound that the variable <code class=\"language-text\">e</code> was assigned the\nmysterisous <code class=\"language-text\">data-ahref</code> attribute inside the <code class=\"language-text\">div</code>\nthat brings us to the hotel webpage. </p>\n<p>Now, to really understands what happens, we also want\nto look at the <code class=\"language-text\">Call Stack</code> tab. The name is quite\nself-explanatory. When the variable <code class=\"language-text\">e</code> holds the\nvalue of the <code class=\"language-text\">data-ahref</code> attribute, we are in a\nfunction called <code class=\"language-text\">t.asdf</code>.\nWe step out of the <code class=\"language-text\">t.asdf</code> function and found that\nthere is a return value of </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/Commerce?p=TABAIndependentHotels&amp;src=0&amp;geo=652907&amp;from=Hotel_Review&amp;area=&amp;slot=1&amp;...\n(omitted for readability)</code></pre></div>\n<p>If you prepend <code class=\"language-text\">www.tripadvisor.com</code>, that is exactly\nthe webpage that returns the redirection script!</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle mathsize=\"1.728em\"><mrow><mi mathvariant=\"script\">B</mi><mi>I</mi><mi>N</mi><mi>G</mi><mi>O</mi><mo stretchy=\"false\">!</mo></mrow></mstyle></mrow><annotation encoding=\"application/x-tex\">\\LARGE{\\mathcal BINGO!}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.19999232em;vertical-align:0em;\"></span><span class=\"mord sizing reset-size6 size9\"><span class=\"mord mathcal\" style=\"margin-right:0.03041em;\">B</span><span class=\"mord mathdefault\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathdefault\">G</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">O</span><span class=\"mclose\">!</span></span></span></span></span></p>\n<p>This means that some function <code class=\"language-text\">t.asdf</code> takes in\nthe <code class=\"language-text\">data-ahref</code> value, decodes it and returns us the\ncorrect URL!</p>\n<p>Now, we read the source code.\nChrome Debugger is not showing me the code,\nbut we know which file it is in.\nChrome Debugger opens a window that “shows” the file\nthat the script being executed is in.\nIt is some file called <code class=\"language-text\">Hotel_Review....Hong_Kong.html</code>.</p>\n<p>We right click on the tab, get the link to this file.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2bcdca1907515988f9f043935d63074/4b160/get_link.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.78922716627635%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB50lEQVQ4y42TW4/aMBCF+f9/qFKfqqqVVgiWUtjc4yTOxXGuThRgueV04hW8UbB0NB5Z+s54xp6ZtgvL8WBYDqY9Czls14dpuTo3KEYRR1EUkKSiqki1jrIsIUQGK6wQp3SeS8zyZgdJEvUAUQ0o1AF5/ZVPZ3HeIi9rMrCwnM9hLubY/PqJt+/fENsG+k4hSRMw5w1FtsYMT9Y4XqGaBsmfBaLfP5D4HgLPhUcGJQ8xxCGKNITv0jlbYjaOIx5pWsfPT6iQgfs+bMehlkRwPA8bwwCLE/Qph2Qe3v9SHvDHFd6Ap90AFTGIJAanyiqRkjLkZFK6lgZmlC+W74jJ4CnweDpB5Rn81QI29U96DkrmYpACQ99h2O0hZQHX9ZAk6QvA4xGq6+GxAOvNVmuxWiGgqydpioiiEDmapsX1en0RqFp4rov1eo2P7RYZgdIkAeccIQGnCg3TRpaJF3pIV26mKRPAp8GkBOv7/q5hoOeV59h+GKjq+rUK27alxx1pYBzHOldK6dh1HUp64BF9iAP19GVgEAQwTfNe4QScopRSm9R5g0O3fw68XC73ChljGqi/IYGmKITQV1ZVjzaW//8pN+g0vZsmg/P5fNfU48v5gn2/RyHa5xXe4mNXGtz5hJo32BUt/gHDUSl26hmu1AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"get_link.png\"\n        title=\"get_link.png\"\n        src=\"/static/d2bcdca1907515988f9f043935d63074/e49a9/get_link.png\"\n        srcset=\"/static/d2bcdca1907515988f9f043935d63074/8d449/get_link.png 160w,\n/static/d2bcdca1907515988f9f043935d63074/01387/get_link.png 320w,\n/static/d2bcdca1907515988f9f043935d63074/e49a9/get_link.png 640w,\n/static/d2bcdca1907515988f9f043935d63074/4b160/get_link.png 854w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We download it with <code class=\"language-text\">curl</code>\n(<a href=\"https://linux.die.net/man/1/curl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">read about curl</a>). </p>\n<h2> <kbd>Ctrl</kbd>+<kbd>F</kbd> </h2>\n<p>Finally, we find the <code class=\"language-text\">t.asdf</code> function\nand study its definition.\nThe code is not readable since the HTML file\nis minified. I used VSCode Beautify extension\nto pretty print the code.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"utils/asdf-encoder\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"ns-exporter\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"vanillajs\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> t <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> t<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getOffset</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> e <span class=\"token operator\">>=</span> <span class=\"token number\">97</span> <span class=\"token operator\">&amp;&amp;</span> e <span class=\"token operator\">&lt;=</span> <span class=\"token number\">122</span> <span class=\"token operator\">?</span> e <span class=\"token operator\">-</span> <span class=\"token number\">61</span> <span class=\"token punctuation\">:</span> e <span class=\"token operator\">>=</span> <span class=\"token number\">65</span> <span class=\"token operator\">&amp;&amp;</span> e <span class=\"token operator\">&lt;=</span> <span class=\"token number\">90</span> <span class=\"token operator\">?</span> e <span class=\"token operator\">-</span> <span class=\"token number\">55</span> <span class=\"token punctuation\">:</span> e <span class=\"token operator\">>=</span> <span class=\"token number\">48</span> <span class=\"token operator\">&amp;&amp;</span> e <span class=\"token operator\">&lt;=</span> <span class=\"token number\">71</span> <span class=\"token operator\">?</span> e <span class=\"token operator\">-</span> <span class=\"token number\">48</span> <span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">asdf</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> t <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&amp;\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"=\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"p\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"6\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"?\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"H\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"B\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".com\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"k\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"9\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".html\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"n\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"M\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"www.\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"h\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"t\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"O\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"j\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"http://\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"_\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"L\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"i\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"f\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"e\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"N\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"m\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"l\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"4\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"R\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"C\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"y\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"S\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"o\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"+\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"7\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"I\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"3\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"c\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"5\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"u\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"T\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"s\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"w\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"8\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"P\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"g\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"q\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"__3F__\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Photos\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".edu\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Y\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\">\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"`\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"__2D__\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"X\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"slot\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ShowUrl\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Owners\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"[\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"q\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MemberProfile\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ShowUserReviews\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'\"'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hotel\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Expedia\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Vacation\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Discount\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UserReview\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Thumbnail\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"__2F__\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Inspiration\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"V\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Map\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\":\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"@\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"F\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"help\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Rental\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Picture\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hotels\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ftp://\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"x\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"J\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Z\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\";\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Text\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"(\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"x\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GenericAds\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"U\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"careers\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"D\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"members\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Search\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Post\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Q\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"$\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"K\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"W\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Reviews\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\",\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"__2E__\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"{\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"}\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Cheap\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\")\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"#\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".org\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"z\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hotels\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Icon\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".net\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"z\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"pages\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"geo\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"cnt\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"~\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"|\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"tripadvisor\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Images\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"BookingBuddy\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Commerce\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"partnerKey\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"area\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Deals\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"from\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\\\\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"urlKey\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"'\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"WeatherUnderground\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MemberSign\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Maps\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"matchID\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Packages\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"E\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Amenities\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Travel\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".htm\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"!\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"^\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"G\"</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> r <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> a <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> a <span class=\"token operator\">&lt;</span> e<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> a<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> n <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                o <span class=\"token operator\">=</span> n<span class=\"token punctuation\">;</span>\n            t<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> a <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;</span> e<span class=\"token punctuation\">.</span>length <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>a<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span> o <span class=\"token operator\">+=</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> n <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">var</span> s <span class=\"token operator\">=</span> <span class=\"token function\">getOffset</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            r <span class=\"token operator\">+=</span> s <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"String\"</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">typeof</span> t<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>s<span class=\"token punctuation\">]</span> <span class=\"token operator\">?</span> o <span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>s<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">exportTo</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> t\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>So they uses some encoding and decoding scheme,\nand this <code class=\"language-text\">asdf</code> function is to decode the string.\n<strong>There is absolutely no need to understand how the\ndecoding and encoding works.</strong>\nOur goal is to get the URL.\nWe can find the encoded version very easily via XPath.\nWe also have the decoder function. </p>\n<p>There is really no difficulty left to parsing\nthe URL.</p>\n<p>To be very honest, after so much complexity,\nI was expecting that may be they encode each\nURL differently. May be there is a custom decoding\nfunction for each different hotel. I might have to\nextract the decoder function from the html page!\nWhat a nightmare. But gladly it is only a dream,\nsince this decoder works on all of the links!</p>\n<h3 id=\"afterthoughts\"><a href=\"#afterthoughts\" aria-label=\"afterthoughts permalink\" class=\"gatsby-remark-autolink-headers-a-tags\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Afterthoughts</h3>\n<p>I have heard there are different approaches to this\ntask. Some parses the name of the hotel instead,\nfollowed by a Google search on the name and attempt\nto filter out the result from TripAdvisor or\nBooking.com. IMO it is quite unreliable since\nit is hard to make sure that it is correct.\nI do not know if the person had looked into getting\nthe link from the website. I would have given up\nif I do not have that much free time to mess with it.\nGot better things in life to do amirite…</p>\n<p>I also found other articles about parsing TripAdvisor\nlinks. It turns out people had already done similar\nthings before. For instance, this one:\n<a href=\"https://kaijento.github.io/2017/03/17/web-scraping-tripadvisor.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://kaijento.github.io/2017/03/17/web-scraping-tripadvisor.com/</a>.\nBut you have to trust me.\nI really did everything on my own <code class=\"language-text\">:|</code>.\nThe main point of the post is not to show how\nyou can crawl TripAdvisor URL. But rather how I\napproached the problem and solve it with the available\ntooling. If you want the code to do the parsing,\ncheck the other block post I linked above.</p>\n<p>But looking at the code above,\nI have some more questions to think about now.\nFor instance, in the <code class=\"language-text\">t.getOffset</code> helper function,\nwhich is used by <code class=\"language-text\">t.asdf</code> decoder, the logic is written\nin the ternary operator <code class=\"language-text\">&lt;cond&gt;?&lt;then&gt;:&lt;else&gt;</code>.\nIt is not only one condition, it is multiple ternary\ncondition aggregated together!\nWhy is it written in this way instead of a more-readable\nif-statement? Is it faster? We shall investigate\nit in another blog post perhaps.</p>","frontmatter":{"date":"2019-06-22","title":"Parsing TripAdvisor for Hotel URLs","subtitle":"I explored how TripAdvisor encode their Hotel URls, with the help of Chrome Dev Tools."},"timeToRead":9}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019-06-22-tripadvisor-url-parsing/","prev":{"title":"Ajax and the Halting Problem","path":"/blog/2019-06-23-ajax-and-the-halting-problem/"}}}}